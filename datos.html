<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
<head>
<title>Manejo de datos con R</title>
<!-- 2015-05-07 jue 12:25 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Oscar Perpiñán Lamigueiro \\ [[http://oscarperpinan.github.io]]" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/readtheorg/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/readtheorg/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Manejo de datos con R</h1>
<div id="table-of-contents">
<h2>&Iacute;ndice</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Lectura de datos</a>
<ul>
<li><a href="#sec-1-1">1.1. <code>setwd</code>, <code>getwd</code>, <code>dir</code></a></li>
<li><a href="#sec-1-2">1.2. Lectura de datos con <code>read.table</code></a></li>
<li><a href="#sec-1-3">1.3. Lectura de datos con <code>read.csv</code></a></li>
<li><a href="#sec-1-4">1.4. Inspeccionamos el resultado</a></li>
<li><a href="#sec-1-5">1.5. Inspeccionamos el resultado</a></li>
<li><a href="#sec-1-6">1.6. Valores ausentes</a></li>
<li><a href="#sec-1-7">1.7. Valores ausentes</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Indexado</a>
<ul>
<li><a href="#sec-2-1">2.1. Indexado con <code>[]</code></a></li>
<li><a href="#sec-2-2">2.2. Indexado con <code>[]</code></a></li>
<li><a href="#sec-2-3">2.3. <code>subset</code></a></li>
</ul>
</li>
<li><a href="#sec-3">3. Cambio de formato</a>
<ul>
<li><a href="#sec-3-1">3.1. Forma simple con <code>stack</code></a></li>
<li><a href="#sec-3-2">3.2. Más flexible con <code>reshape2</code></a></li>
<li><a href="#sec-3-3">3.3. <code>melt</code> para cambiar de <i>wide</i> a <i>long</i></a></li>
<li><a href="#sec-3-4">3.4. <code>dcast</code> para cambiar de <i>long</i> a <i>wide</i></a></li>
</ul>
</li>
<li><a href="#sec-4">4. Datos agregados</a>
<ul>
<li><a href="#sec-4-1">4.1. <code>aggregate</code></a></li>
<li><a href="#sec-4-2">4.2. Variable categórica con <code>cut</code></a></li>
<li><a href="#sec-4-3">4.3. Agregamos varias variables</a></li>
<li><a href="#sec-4-4">4.4. Agregamos a partir de un formato <code>long</code></a></li>
</ul>
</li>
<li><a href="#sec-5">5. Unión de <code>data.frame</code></a>
<ul>
<li><a href="#sec-5-1">5.1. Con <code>merge</code></a></li>
<li><a href="#sec-5-2">5.2. Con <code>merge</code></a></li>
<li><a href="#sec-5-3">5.3. <code>merge</code> usa <code>match</code></a></li>
<li><a href="#sec-5-4">5.4. <code>merge</code> usa <code>match</code></a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Lectura de datos</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> <code>setwd</code>, <code>getwd</code>, <code>dir</code></h3>
<div class="outline-text-3" id="text-1-1">
<p>
En <code>setwd</code> hay que especificar el directorio que contiene el repositorio.
</p>
<div class="org-src-container">

<pre class="src src-R">getwd()
old <span class="org-constant">&lt;-</span> setwd(<span class="org-string">"~/github/intro"</span>)
dir()
</pre>
</div>

<div class="org-src-container">

<pre class="src src-R">dir(pattern=<span class="org-string">'.R'</span>)
</pre>
</div>

<pre class="example">
[1] "ClasesMetodos.R"       "datos.R"               "estadistica.R"        
[4] "factorDateCharacter.R" "Funciones.R"           "graficos.R"           
[7] "intro.R"               "raster.R"              "zoo.R"
</pre>

<div class="org-src-container">

<pre class="src src-R">dir(<span class="org-string">'data'</span>)
</pre>
</div>

<pre class="example">
[1] "aranjuez.csv"        "aranjuez.RData"      "CO2_GNI_BM.csv"     
[4] "El.Arenosillo.txt"   "InformeDatos.zip"    "NREL-Hawaii.csv"    
[7] "radiacion_datas.csv" "SIAR.csv"            "SISmm2008_CMSAF.zip"
</pre>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> Lectura de datos con <code>read.table</code></h3>
<div class="outline-text-3" id="text-1-2">
<div class="org-src-container">

<pre class="src src-R">dats <span class="org-constant">&lt;-</span> read.table(<span class="org-string">'data/aranjuez.csv'</span>, sep=<span class="org-string">','</span>, header=<span class="org-type">TRUE</span>)
head(dats)
</pre>
</div>

<pre class="example">
           X TempAvg TempMax TempMin HumidAvg HumidMax WindAvg WindMax Rain
1 2004-01-01   4.044   10.71  -1.969     88.3     95.9   0.746   3.528    0
2 2004-01-02   5.777   11.52   1.247     83.3     98.5   1.078   6.880    0
3 2004-01-03   5.850   13.32   0.377     75.0     94.4   0.979   6.576    0
4 2004-01-04   4.408   15.59  -2.576     82.0     97.0   0.633   3.704    0
5 2004-01-05   3.081   14.58  -2.974     83.2     97.0   0.389   2.244    0
6 2004-01-06   2.304   11.83  -3.379     84.5     96.5   0.436   2.136    0
  Radiation        ET
1     5.490 0.5352688
2     6.537 0.7710499
3     8.810 0.8361229
4     9.790 0.6861381
5    10.300 0.5152422
6     9.940 0.4886631
</pre>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Lectura de datos con <code>read.csv</code></h3>
<div class="outline-text-3" id="text-1-3">
<div class="org-src-container">

<pre class="src src-R">aranjuez <span class="org-constant">&lt;-</span> read.csv(<span class="org-string">'data/aranjuez.csv'</span>)
names(aranjuez)[1] <span class="org-constant">&lt;-</span> <span class="org-string">'Date'</span>
</pre>
</div>

<div class="org-src-container">

<pre class="src src-R">class(aranjuez)
</pre>
</div>

<pre class="example">
[1] "data.frame"
</pre>

<div class="org-src-container">

<pre class="src src-R">names(aranjuez)
</pre>
</div>

<pre class="example">
[1] "Date"      "TempAvg"   "TempMax"   "TempMin"   "HumidAvg"  "HumidMax" 
[7] "WindAvg"   "WindMax"   "Rain"      "Radiation" "ET"
</pre>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Inspeccionamos el resultado</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">

<pre class="src src-R">head(aranjuez)
</pre>
</div>

<pre class="example">
        Date TempAvg TempMax TempMin HumidAvg HumidMax WindAvg WindMax Rain
1 2004-01-01   4.044   10.71  -1.969     88.3     95.9   0.746   3.528    0
2 2004-01-02   5.777   11.52   1.247     83.3     98.5   1.078   6.880    0
3 2004-01-03   5.850   13.32   0.377     75.0     94.4   0.979   6.576    0
4 2004-01-04   4.408   15.59  -2.576     82.0     97.0   0.633   3.704    0
5 2004-01-05   3.081   14.58  -2.974     83.2     97.0   0.389   2.244    0
6 2004-01-06   2.304   11.83  -3.379     84.5     96.5   0.436   2.136    0
  Radiation        ET
1     5.490 0.5352688
2     6.537 0.7710499
3     8.810 0.8361229
4     9.790 0.6861381
5    10.300 0.5152422
6     9.940 0.4886631
</pre>

<div class="org-src-container">

<pre class="src src-R">tail(aranjuez)
</pre>
</div>

<pre class="example">
           Date TempAvg TempMax TempMin HumidAvg HumidMax WindAvg WindMax  Rain
2893 2011-12-26   3.366   13.88  -3.397     81.5      100   0.556   3.263 0.000
2894 2011-12-27   2.222   13.33  -4.005     87.0      100   0.369   1.842 0.000
2895 2011-12-28   1.810   12.33  -4.682     85.0      100   0.540   3.401 0.203
2896 2011-12-29   2.512   11.92  -4.682     77.2      100   0.546   4.420 0.203
2897 2011-12-30   1.006   11.05  -5.822     79.7      100   0.446   2.832 0.000
2898 2011-12-31   2.263   12.67  -3.938     80.3      100   0.270   1.950 0.000
     Radiation        ET
2893      9.44 0.5358751
2894      9.52 0.4386931
2895      9.59 0.5183545
2896      9.72 0.5428373
2897      9.74 0.4614953
2898      8.11 0.4246270
</pre>
</div>
</div>

<div id="outline-container-sec-1-5" class="outline-3">
<h3 id="sec-1-5"><span class="section-number-3">1.5</span> Inspeccionamos el resultado</h3>
<div class="outline-text-3" id="text-1-5">
<div class="org-src-container">

<pre class="src src-R">summary(aranjuez)
</pre>
</div>

<pre class="example">
         Date         TempAvg          TempMax          TempMin       
 2004-01-01:   1   Min.   :-5.309   Min.   :-2.362   Min.   :-12.980  
 2004-01-02:   1   1st Qu.: 7.692   1st Qu.:14.530   1st Qu.:  1.515  
 2004-01-03:   1   Median :13.810   Median :21.670   Median :  7.170  
 2004-01-04:   1   Mean   :14.405   Mean   :22.531   Mean   :  6.888  
 2004-01-05:   1   3rd Qu.:21.615   3rd Qu.:30.875   3rd Qu.: 12.590  
 2004-01-06:   1   Max.   :30.680   Max.   :41.910   Max.   : 22.710  
 (Other)   :2892                                     NA's   :4        
    HumidAvg         HumidMax         WindAvg         WindMax      
 Min.   : 19.89   Min.   : 35.88   Min.   :0.251   Min.   : 0.000  
 1st Qu.: 47.04   1st Qu.: 81.60   1st Qu.:0.667   1st Qu.: 3.783  
 Median : 62.58   Median : 90.90   Median :0.920   Median : 5.027  
 Mean   : 62.16   Mean   : 87.22   Mean   :1.174   Mean   : 5.208  
 3rd Qu.: 77.38   3rd Qu.: 94.90   3rd Qu.:1.431   3rd Qu.: 6.537  
 Max.   :100.00   Max.   :100.00   Max.   :8.260   Max.   :10.000  
                  NA's   :13       NA's   :8       NA's   :128     
      Rain          Radiation            ET       
 Min.   : 0.000   Min.   : 0.277   Min.   :0.000  
 1st Qu.: 0.000   1st Qu.: 9.370   1st Qu.:1.168  
 Median : 0.000   Median :16.660   Median :2.758  
 Mean   : 1.094   Mean   :16.742   Mean   :3.091  
 3rd Qu.: 0.200   3rd Qu.:24.650   3rd Qu.:4.926  
 Max.   :49.730   Max.   :32.740   Max.   :8.564  
 NA's   :4        NA's   :13       NA's   :18
</pre>
</div>
</div>

<div id="outline-container-sec-1-6" class="outline-3">
<h3 id="sec-1-6"><span class="section-number-3">1.6</span> Valores ausentes</h3>
<div class="outline-text-3" id="text-1-6">
<ul class="org-ul">
<li><code>NA</code> está definido como <code>logical</code>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">class(<span class="org-type">NA</span>)
</pre>
</div>

<pre class="example">
[1] "logical"
</pre>

<ul class="org-ul">
<li>Operar con <code>NA</code> siempre produce un <code>NA</code>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">1 + <span class="org-type">NA</span>
</pre>
</div>

<pre class="example">
[1] NA
</pre>

<ul class="org-ul">
<li>Esto es un &laquo;problema&raquo; al usar funciones
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">mean(aranjuez$Radiation)
</pre>
</div>

<pre class="example">
[1] NA
</pre>

<div class="org-src-container">

<pre class="src src-R">mean(aranjuez$Radiation, na.rm =  <span class="org-type">TRUE</span>)
</pre>
</div>

<pre class="example">
[1] 16.74176
</pre>
</div>
</div>

<div id="outline-container-sec-1-7" class="outline-3">
<h3 id="sec-1-7"><span class="section-number-3">1.7</span> Valores ausentes</h3>
<div class="outline-text-3" id="text-1-7">
<p>
Las funciones <code>is.na</code> y <code>anyNA</code> los identifican 
</p>
<div class="org-src-container">

<pre class="src src-R">anyNA(aranjuez)
</pre>
</div>

<pre class="example">
[1] TRUE
</pre>

<div class="org-src-container">

<pre class="src src-R">which(is.na(aranjuez$Radiation))
</pre>
</div>

<pre class="example">
[1] 1861 1867 1873 1896 1897 1908 1923 2153 2413 2587 2600 2603 2684
</pre>

<div class="org-src-container">

<pre class="src src-R">sum(is.na(aranjuez$Radiation))
</pre>
</div>

<pre class="example">
[1] 13
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Indexado</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Indexado con <code>[]</code></h3>
<div class="outline-text-3" id="text-2-1">
<ul class="org-ul">
<li>Filas
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">aranjuez[1:5,]
</pre>
</div>

<pre class="example">
        Date TempAvg TempMax TempMin HumidAvg HumidMax WindAvg WindMax Rain
1 2004-01-01   4.044   10.71  -1.969     88.3     95.9   0.746   3.528    0
2 2004-01-02   5.777   11.52   1.247     83.3     98.5   1.078   6.880    0
3 2004-01-03   5.850   13.32   0.377     75.0     94.4   0.979   6.576    0
4 2004-01-04   4.408   15.59  -2.576     82.0     97.0   0.633   3.704    0
5 2004-01-05   3.081   14.58  -2.974     83.2     97.0   0.389   2.244    0
  Radiation        ET
1     5.490 0.5352688
2     6.537 0.7710499
3     8.810 0.8361229
4     9.790 0.6861381
5    10.300 0.5152422
</pre>

<ul class="org-ul">
<li>Filas y Columnas
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">aranjuez[10:14, 1:5]
</pre>
</div>

<pre class="example">
         Date TempAvg TempMax TempMin HumidAvg
10 2004-01-10   10.85   16.59   5.676     84.9
11 2004-01-11    7.59    9.23   4.806     95.4
12 2004-01-12    7.41   10.24   5.200     93.1
13 2004-01-13    8.35   11.38   4.137     91.3
14 2004-01-14    8.74   13.32   2.857     86.9
</pre>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Indexado con <code>[]</code></h3>
<div class="outline-text-3" id="text-2-2">
<ul class="org-ul">
<li>Condición basada en los datos
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">idx <span class="org-constant">&lt;-</span> with(aranjuez, Radiation &gt; 20 &amp; TempAvg &lt; 10) 

head(aranjuez[idx, ])
</pre>
</div>

<pre class="example">
          Date TempAvg TempMax TempMin HumidAvg HumidMax WindAvg WindMax Rain
82  2004-03-22    9.78   16.12   4.340    51.65     87.9   1.526   7.660    0
83  2004-03-23    8.50   15.52  -0.290    50.10     83.3   1.533   6.027    0
85  2004-03-25    7.47   14.58   1.584    49.66     76.6   1.138   5.939    0
100 2004-04-09    8.83   15.52   2.056    47.50     70.8   1.547   6.125    0
101 2004-04-10    7.04   13.85  -0.155    54.45     85.8   1.448   6.958    0
102 2004-04-11    7.50   15.19  -1.699    54.98     91.0   1.126   7.590    0
    Radiation       ET
82      21.92 3.075785
83      20.62 2.881419
85      22.44 2.849603
100     25.45 3.566452
101     21.07 2.943239
102     20.99 2.905479
</pre>
</div>
</div>

<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> <code>subset</code></h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">

<pre class="src src-R">subset(aranjuez,
       subset = (Radiation &gt; 20 &amp; TempAvg &lt; 10),
       select = c(Radiation, TempAvg,
           TempMax, TempMin))
</pre>
</div>

<pre class="example">
     Radiation TempAvg TempMax TempMin
82       21.92   9.780   16.12   4.340
83       20.62   8.500   15.52  -0.290
85       22.44   7.470   14.58   1.584
100      25.45   8.830   15.52   2.056
101      21.07   7.040   13.85  -0.155
102      20.99   7.500   15.19  -1.699
104      25.76   9.420   17.47   0.115
461      24.29   7.460   14.66  -0.081
462      25.25   7.930   17.35  -1.686
463      24.56   9.800   19.08  -1.484
1146     20.08   7.170   18.20  -3.746
1157     20.90   4.378   12.03  -6.353
1159     21.87   7.920   18.54  -2.941
1160     20.35   7.830   16.49  -2.807
1521     21.54   8.100   19.29  -4.075
2244     20.49   6.121   15.15  -0.940
2245     21.02   5.989   16.94  -3.208
2246     20.22   9.020   19.74  -2.068
2261     23.00   9.500   14.96   3.662
2262     20.40   9.910   14.70   4.668
2263     24.09   9.440   16.89   0.794
2265     23.64   9.680   16.35   2.938
2295     22.46   8.730   13.84   1.740
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Cambio de formato</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Forma simple con <code>stack</code></h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">

<pre class="src src-R">aranjuezWide <span class="org-constant">&lt;-</span> aranjuez[, c(<span class="org-string">'Radiation'</span>,
                             <span class="org-string">'TempAvg'</span>, <span class="org-string">'TempMax'</span>,
                             <span class="org-string">'WindAvg'</span>, <span class="org-string">'WindMax'</span>)]
</pre>
</div>

<ul class="org-ul">
<li>Pasamos de formato <code>wide</code> a <code>long</code>
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">aranjuezLong <span class="org-constant">&lt;-</span> stack(aranjuezWide)

head(aranjuezLong)
</pre>
</div>

<pre class="example">
  values       ind
1  5.490 Radiation
2  6.537 Radiation
3  8.810 Radiation
4  9.790 Radiation
5 10.300 Radiation
6  9.940 Radiation
</pre>

<div class="org-src-container">

<pre class="src src-R">summary(aranjuezLong)
</pre>
</div>

<pre class="example">
    values              ind      
Min.   :-5.309   Radiation:2898  
1st Qu.: 3.158   TempAvg  :2898  
Median : 8.720   TempMax  :2898  
Mean   :12.074   WindAvg  :2898  
3rd Qu.:19.970   WindMax  :2898  
Max.   :41.910                   
NA's   :149
</pre>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Más flexible con <code>reshape2</code></h3>
<div class="outline-text-3" id="text-3-2">
<ul class="org-ul">
<li><code>reshape2</code> es un paquete que puede facilitar la transformación de <code>data.frame</code> y matrices.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-R"><span class="org-constant">library</span>(reshape2)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> <code>melt</code> para cambiar de <i>wide</i> a <i>long</i></h3>
<div class="outline-text-3" id="text-3-3">
<div class="org-src-container">

<pre class="src src-R">aranjuezLong2 <span class="org-constant">&lt;-</span> melt(aranjuez, id.vars = <span class="org-string">'Date'</span>,
                      variable.name = <span class="org-string">'Variable'</span>,
                      value.name = <span class="org-string">'Value'</span>)

head(aranjuezLong2)
</pre>
</div>

<pre class="example">
        Date Variable Value
1 2004-01-01  TempAvg 4.044
2 2004-01-02  TempAvg 5.777
3 2004-01-03  TempAvg 5.850
4 2004-01-04  TempAvg 4.408
5 2004-01-05  TempAvg 3.081
6 2004-01-06  TempAvg 2.304
</pre>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> <code>dcast</code> para cambiar de <i>long</i> a <i>wide</i></h3>
<div class="outline-text-3" id="text-3-4">
<div class="org-src-container">

<pre class="src src-R">aranjuezWide2 <span class="org-constant">&lt;-</span> dcast(aranjuezLong2,
                       Variable ~ Date)
head(aranjuezWide2[, 1:10])
</pre>
</div>

<pre class="example">
 Using Value as value column: use value.var to override.
  Variable 2004-01-01 2004-01-02 2004-01-03 2004-01-04 2004-01-05 2004-01-06
1  TempAvg      4.044      5.777      5.850      4.408      3.081      2.304
2  TempMax     10.710     11.520     13.320     15.590     14.580     11.830
3  TempMin     -1.969      1.247      0.377     -2.576     -2.974     -3.379
4 HumidAvg     88.300     83.300     75.000     82.000     83.200     84.500
5 HumidMax     95.900     98.500     94.400     97.000     97.000     96.500
6  WindAvg      0.746      1.078      0.979      0.633      0.389      0.436
  2004-01-07 2004-01-08 2004-01-09
1      2.080      6.405     12.060
2     11.500     13.380     15.330
3     -3.109     -1.301      9.830
4     87.000     88.600     86.800
5     96.600     97.400     94.500
6      0.449      1.188      2.737
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Datos agregados</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> <code>aggregate</code></h3>
<div class="outline-text-3" id="text-4-1">
<div class="org-src-container">

<pre class="src src-R">aranjuez$rainy <span class="org-constant">&lt;-</span> aranjuez$Rain &gt; 0

aggregate(Radiation ~ rainy, data = aranjuez,
          FUN = mean)
</pre>
</div>

<pre class="example">
  rainy Radiation
1 FALSE  19.63325
2  TRUE  10.26028
</pre>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Variable categórica con <code>cut</code></h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-R">aranjuez$tempClass <span class="org-constant">&lt;-</span> cut(aranjuez$TempAvg, 5)

aggregate(Radiation ~ tempClass, data = aranjuez,
          FUN = mean)
</pre>
</div>

<pre class="example">
     tempClass Radiation
1 (-5.34,1.89]  8.805389
2  (1.89,9.09]  9.014178
3  (9.09,16.3] 14.554177
4  (16.3,23.5] 21.912414
5  (23.5,30.7] 26.192742
</pre>

<div class="org-src-container">

<pre class="src src-R">aggregate(Radiation ~ tempClass + rainy,
          data = aranjuez, FUN = mean)
</pre>
</div>

<pre class="example">
      tempClass rainy Radiation
1  (-5.34,1.89] FALSE  9.869134
2   (1.89,9.09] FALSE 10.718837
3   (9.09,16.3] FALSE 17.238283
4   (16.3,23.5] FALSE 23.238145
5   (23.5,30.7] FALSE 26.392665
6  (-5.34,1.89]  TRUE  6.822955
7   (1.89,9.09]  TRUE  7.063932
8   (9.09,16.3]  TRUE 11.091063
9   (16.3,23.5]  TRUE 15.802522
10  (23.5,30.7]  TRUE 22.545862
</pre>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Agregamos varias variables</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">

<pre class="src src-R">aggregate(cbind(Radiation, TempAvg) ~ tempClass,
          data = aranjuez, FUN = mean)
</pre>
</div>

<pre class="example">
     tempClass Radiation    TempAvg
1 (-5.34,1.89]  8.805389  0.3423095
2  (1.89,9.09]  9.014178  5.6663267
3  (9.09,16.3] 14.554177 12.5219084
4  (16.3,23.5] 21.912414 19.7486310
5  (23.5,30.7] 26.192742 26.0496953
</pre>

<div class="org-src-container">

<pre class="src src-R">aggregate(cbind(Radiation, TempAvg) ~ tempClass + rainy,
          data = aranjuez, FUN = mean)
</pre>
</div>

<pre class="example">
      tempClass rainy Radiation    TempAvg
1  (-5.34,1.89] FALSE  9.869134  0.3550122
2   (1.89,9.09] FALSE 10.718837  5.6657481
3   (9.09,16.3] FALSE 17.238283 12.6959488
4   (16.3,23.5] FALSE 23.238145 19.9486604
5   (23.5,30.7] FALSE 26.392665 26.0896408
6  (-5.34,1.89]  TRUE  6.822955  0.3186364
7   (1.89,9.09]  TRUE  7.063932  5.6669887
8   (9.09,16.3]  TRUE 11.091063 12.2973563
9   (16.3,23.5]  TRUE 15.802522 18.8267565
10  (23.5,30.7]  TRUE 22.545862 25.3210345
</pre>
</div>
</div>


<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Agregamos a partir de un formato <code>long</code></h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">

<pre class="src src-R">head(aranjuezLong2)
</pre>
</div>

<pre class="example">
        Date Variable Value
1 2004-01-01  TempAvg 4.044
2 2004-01-02  TempAvg 5.777
3 2004-01-03  TempAvg 5.850
4 2004-01-04  TempAvg 4.408
5 2004-01-05  TempAvg 3.081
6 2004-01-06  TempAvg 2.304
</pre>

<div class="org-src-container">

<pre class="src src-R">aggregate(Value ~ Variable, data = aranjuezLong2,
          FUN = mean)
</pre>
</div>

<pre class="example">
    Variable     Value
1    TempAvg 14.404856
2    TempMax 22.531033
3    TempMin  6.887590
4   HumidAvg 62.160390
5   HumidMax 87.216887
6    WindAvg  1.173983
7    WindMax  5.208021
8       Rain  1.094255
9  Radiation 16.741759
10        ET  3.091191
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Unión de <code>data.frame</code></h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Con <code>merge</code></h3>
<div class="outline-text-3" id="text-5-1">
<ul class="org-ul">
<li>Primero construimos un <code>data.frame</code> de ejemplo
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">USStates <span class="org-constant">&lt;-</span> as.data.frame(state.x77)
USStates$Name <span class="org-constant">&lt;-</span> rownames(USStates)
rownames(USStates) <span class="org-constant">&lt;-</span> <span class="org-type">NULL</span>
</pre>
</div>

<ul class="org-ul">
<li>Lo partimos en estados &laquo;fríos&raquo; y estados &laquo;grandes&raquo;
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">coldStates <span class="org-constant">&lt;-</span> USStates[USStates$Frost&gt;150,
                       c(<span class="org-string">'Name'</span>, <span class="org-string">'Frost'</span>)]
largeStates <span class="org-constant">&lt;-</span> USStates[USStates$Area&gt;1e5,
                        c(<span class="org-string">'Name'</span>, <span class="org-string">'Area'</span>)]
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Con <code>merge</code></h3>
<div class="outline-text-3" id="text-5-2">
<ul class="org-ul">
<li>Unimos los dos conjuntos (estados &laquo;fríos&raquo; y &laquo;grandes&raquo;)
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">merge(coldStates, largeStates)
</pre>
</div>

<pre class="example">
      Name Frost   Area
1   Alaska   152 566432
2 Colorado   166 103766
3  Montana   155 145587
4   Nevada   188 109889
</pre>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> <code>merge</code> usa <code>match</code></h3>
<div class="outline-text-3" id="text-5-3">
<ul class="org-ul">
<li>Estados grandes que también son fríos
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">idxLarge <span class="org-constant">&lt;-</span> match(largeStates$Name,
                  coldStates$Name,
                  nomatch=0)
idxLarge
</pre>
</div>

<pre class="example">
[1] 1 0 0 2 5 6 0 0
</pre>

<div class="org-src-container">

<pre class="src src-R">coldStates[idxLarge,]
</pre>
</div>

<pre class="example">
       Name Frost
2    Alaska   152
6  Colorado   166
26  Montana   155
28   Nevada   188
</pre>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4"><span class="section-number-3">5.4</span> <code>merge</code> usa <code>match</code></h3>
<div class="outline-text-3" id="text-5-4">
<ul class="org-ul">
<li>Estados frios que también son grandes
</li>
</ul>
<div class="org-src-container">

<pre class="src src-R">idxCold <span class="org-constant">&lt;-</span> match(coldStates$Name,
                 largeStates$Name,
                 nomatch=0)
idxCold
</pre>
</div>

<pre class="example">
[1] 1 4 0 0 5 6 0 0 0 0 0
</pre>

<div class="org-src-container">

<pre class="src src-R">largeStates[idxCold,]
</pre>
</div>

<pre class="example">
       Name   Area
2    Alaska 566432
6  Colorado 103766
26  Montana 145587
28   Nevada 109889
</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Autor: Oscar Perpiñán Lamigueiro \\ <a href="http://oscarperpinan.github.io">http://oscarperpinan.github.io</a></p>
<p class="date">Created: 2015-05-07 jue 12:25</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.7c)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
